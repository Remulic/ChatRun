(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/run/run"],{"0718":function(t,n,i){"use strict";(function(t){i("1a46");e(i("66fd"));var n=e(i("d98e"));function e(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(n.default)}).call(this,i("543d")["createPage"])},"4e46":function(t,n,i){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;i("66fd");var e=function(t){return t&&t.__esModule?t:{default:t}}(i("ec9e"));var o={data:function(){return{pageIndex:3,polyline:[],meters:0,time:"04:30",originalTime:0,point:[],isstart:0,isrun:1,isplay:0,isedn:0,latitude:"0",longitude:"0",scale:13,bottomData:!1,innerAudioContext:{},_locationChangeFn:""}},components:{myFootBar:function(){i.e("components/myFootBar").then(function(){return resolve(i("4079"))}.bind(null,i)).catch(i.oe)}},onLoad:function(){this.getStorages(),this.getuserLocation(),this.musicCreate()},methods:{getStorages:function(){try{var n=t.getStorageSync("user");n?(this.uid=n.id,this.imgurl=this.serverUrl+"/"+n.imgurl,this.token=n.token,this.myname=n.name):t.navigateTo({url:"../signin/signin"})}catch(i){}},getuserLocation:function(){var n=this;t.getLocation({geocode:!0,type:"gcj02",success:function(t){console.log(t,"获取当前位置"),n.latitude=t.latitude,n.longitude=t.longitude},fail:function(n){t.openSetting({success:function(t){t.authSetting={"scope.userLocation":!0}},fail:function(){t.showToast({title:"授权失败",icon:"error",duration:2e3})}})}})},start:function(){this.isstart=!this.isstart,this.isstart&&(console.log("start"),this.location(),this.timer())},stop:function(){this.isrun=!this.isrun,this.isrun?(console.log("start"),this.timer(),this.location()):console.log("stop"),console.log(this._locationChangeFn),console.log(this.point)},end:function(){this.isedn=1,console.log("end"),this.isrun?this.stop():this.location(),this.endLoding()},musicCreate:function(){this.innerAudioContext=t.createInnerAudioContext(),this.innerAudioContext.src="https://codehhr.gitee.io/musics/new_life.mp3"},ctrlMusic:function(){var t=this;this.isplay=!this.isplay,console.log(this.isplay),this.isplay?(this.innerAudioContext.play(),console.log("music playing !"),this.innerAudioContext.onEnded((function(){console.log("music end !"),t.isplay=!t.isplay,console.log("music replay !"),t.ctrlMusic()}))):this.innerAudioContext.stop()},location:function(){var n=this;1==this.isend?(t.stopLocationUpdate(this._locationChangeFn),t.offLocationUpdate(this._locationChangeFn)):(t.startLocationUpdate({success:function(i){t.onLocationChange(n._locationChangeFn)},fail:function(n){t.openSetting({success:function(t){t.authSetting={"scope.userLocation":!0}}})}}),this._locationChangeFn=function(t){if(0==n.isstart||0==n.isrun)n.point=[];else{var i=t.latitude,e=t.longitude;if(n.point.push({latitude:i,longitude:e}),console.log(n.point),n.point.length>=3)n.point.shift();n.drawline(),n.distance()}})},drawline:function(){this.polyline=[{points:this.point,color:"#99FF00",width:4,dottedLine:!1}]},distance:function(){var t=this.point.length;if(t>=2){var n={latitude:this.point[t-1].latitude,longitude:this.point[t-1].longitude},i={latitude:this.point[t-2].latitude,longitude:this.point[t-2].longitude},o=e.default.getDistance(i.latitude,i.longitude,n.latitude,n.longitude)/1e3;this.meters+=e.default.getnum(o),console.log(this.meters)}},timer:function(){var t=this;0!=this.isrun&&setTimeout((function(){t.originalTime+=100,t.time=e.default.date_format(t.originalTime),t.timer()}),100)},endLoding:function(){var n=this;t.showModal({title:"提醒",content:"是否保存数据",success:function(i){i.confirm&&(t.showLoading({title:"保存中"}),n.getdata(),t.hideLoading())}})},getdata:function(){var n=this;t.request({url:this.serverUrl+"/run/findrundate",data:{id:this.uid,token:this.token},method:"POST",success:function(i){var o=i.data.status,s=i.data.result;if(console.log(s),200===o){var a=n.meters+s.distance,u=e.default.getnum(n.originalTime/6e4)+s.runTime;console.log(a,u),console.log(typeof u),n.update(a,u)}else 500===o?t.showToast({title:"服务器出错了...",icon:"none",duration:1500}):300===o&&t.navigateTo({url:"/pages/signin/signin?name="+n.myname})}})},update:function(n,i){t.request({url:this.serverUrl+"/run/updaterundate",data:{id:this.uid,distance:n,runTime:i,token:this.token},method:"POST",success:function(n){var i=n.data.status;200===i?t.showToast({title:"修改成功",icon:"none",duration:1500}):500===i&&t.showToast({title:"服务器出错了...",icon:"none",duration:1500})}})}}};n.default=o}).call(this,i("543d")["default"])},7835:function(t,n,i){},"9adc":function(t,n,i){"use strict";i.d(n,"b",(function(){return e})),i.d(n,"c",(function(){return o})),i.d(n,"a",(function(){}));var e=function(){var t=this.$createElement;this._self._c},o=[]},a30d:function(t,n,i){"use strict";var e=i("7835"),o=i.n(e);o.a},bb47:function(t,n,i){"use strict";i.r(n);var e=i("4e46"),o=i.n(e);for(var s in e)["default"].indexOf(s)<0&&function(t){i.d(n,t,(function(){return e[t]}))}(s);n["default"]=o.a},d98e:function(t,n,i){"use strict";i.r(n);var e=i("9adc"),o=i("bb47");for(var s in o)["default"].indexOf(s)<0&&function(t){i.d(n,t,(function(){return o[t]}))}(s);i("a30d");var a=i("f0c5"),u=Object(a["a"])(o["default"],e["b"],e["c"],!1,null,null,null,!1,e["a"],void 0);n["default"]=u.exports}},[["0718","common/runtime","common/vendor"]]]);