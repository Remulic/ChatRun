(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/userdetials/userdetials"],{"1e23":function(t,e,i){"use strict";var a=i("fe66"),n=i.n(a);n.a},"3f05":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=function(t){return t&&t.__esModule?t:{default:t}}(i("ec9e"));function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var s={data:function(){var t,e=this.getDate({format:!0});return t={sexArr:["男","女","密"],index:0,date:e,time:"12:01",cropFilePath:"../../static/images/img/avatar1.jpg",tempFilePath:"",data:"",psw:void 0,type:"",olddata:"",showModify:!1},n(t,"psw",""),n(t,"modifyTitle",""),n(t,"type",""),n(t,"haspwd",!1),n(t,"myname",""),n(t,"id",""),n(t,"uid",""),n(t,"token",""),n(t,"imgurl",""),n(t,"user",""),n(t,"markname",""),n(t,"meter",""),n(t,"runtime",""),t},components:{ImageCropper:function(){i.e("components/ling-imgcropper/ling-imgcropper").then(function(){return resolve(i("8cac"))}.bind(null,i)).catch(i.oe)}},methods:{getStorages:function(){try{var e=t.getStorageSync("user");e?(this.uid=e.id,this.token=e.token,this.myname=e.name,this.imgurl=e.imgurl,this.msg=this.myname+"请求加为好友~"):t.navigateTo({url:"../signin/signin"})}catch(i){}},getUser:function(){var e=this;t.request({url:this.serverUrl+"/user/detial",data:{id:this.id,token:this.token},method:"POST",success:function(i){var a=i.data.status,n=i.data.result;200===a?(e.cropFilePath=e.serverUrl+n.imgurl,n.imgurl=e.serverUrl+n.imgurl,void 0===n.explain&&(n.explain="这个人很懒，啥都没写~"),void 0===n.birth?n.birth="1999-01-01":e.date=n.birth,void 0===n.phone&&(n.phone=""),0===e.markname.length&&(e.markname=n.name),e.sexJudge(n.sex),e.user=n):500===a?t.showToast({title:"服务器出错了...",icon:"none",duration:1500}):300===a&&t.navigateTo({url:"/pages/signin/signin?name="+e.myname})}})},getMarkname:function(){var e=this;this.id!==this.uid&&t.request({url:this.serverUrl+"/user/getmarkname",data:{uid:this.uid,fid:this.id,token:this.token},method:"POST",success:function(i){var a=i.data.status;if(200==a){var n=i.data.result;void 0!==n.markname&&(e.markname=n.markname)}else 400==a||500==a&&t.showToast({title:"服务器出错了...",icon:"none",duration:1500})}})},backOnePage:function(){t.navigateBack({delta:1})},timeChange:function(t){return a.default.detialTime(t)},sexJudge:function(t){this.index="asexual"===t?2:"male"===t?0:1},bindPickerChange:function(t){var e=this.index;if(this.index=t.target.value,this.index!==e){var i="asexual";0===this.index?i="male":1===this.index&&(i="female"),this.update(i,"sex",void 0)}},bindDateChange:function(t){var e=this.date;this.date=t.target.value,this.date!==e&&(this.update(this.date,"birth",void 0),this.user["birth"]=this.date)},getDate:function(t){var e=new Date,i=e.getFullYear(),a=e.getMonth()+1,n=e.getDate();return"start"===t?i-=60:"end"===t&&(i+=2),a=a>9?a:"0"+a,n=n>9?n:"0"+n,"".concat(i,"-").concat(a,"-").concat(n)},upload:function(){var e=this;t.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(t){e.tempFilePath=t.tempFilePaths.shift()}})},confirm:function(e){var i=this;this.tempFilePath="",this.cropFilePath=e.detail.tempFilePath,this.headimg=e.detail.tempFilePath,t.uploadFile({url:this.serverUrl+"/files/upload",filePath:this.headimg,name:"file",fileType:"image",formData:{url:"user",name:this.uid,token:this.token},success:function(a){var n=a.data;try{t.setStorageSync("user",{id:i.uid,name:i.myname,imgurl:n,token:i.token})}catch(e){console.log("数据存储错误")}i.update(n,"imgurl",void 0)},fail:function(t){}})},cancel:function(){this.tempFilePath=""},update:function(e,i,a){var n=this;t.request({url:this.serverUrl+"/user/update",data:{id:this.uid,data:e,type:i,psw:a,token:this.token},method:"POST",success:function(e){var a=e.data.status;200==a?("psw"===i&&(t.removeStorage({key:"user",success:function(){}}),t.navigateTo({url:"/pages/signin/signin?updatepsw="+n.myname})),n.showModify=!1,t.showToast({title:"修改成功",icon:"none",duration:1500})):300==a?t.navigateTo({url:"/pages/signin/signin"}):400==a?t.showToast({title:"请输入正确的密码",icon:"none",duration:1500}):201==a?t.showToast({title:"邮箱已占用",icon:"none",duration:1500}):500==a&&t.showToast({title:"服务器出错了...",icon:"none",duration:1500})}})},updateFriendMN:function(){var e=this;this.data.length>0&&this.data!==this.olddata&&t.request({url:this.serverUrl+"/user/updatemarkname",data:{uid:this.uid,fid:this.id,name:this.data,token:this.token},method:"POST",success:function(i){var a=i.data.status;200==a?(e.showModify=!1,t.showToast({title:"修改成功",icon:"none",duration:1500})):300==a?t.navigateTo({url:"/pages/signin/signin?name="+e.myname}):400==a||500==a&&t.showToast({title:"服务器出错了...",icon:"none",duration:1500})}})},modifyData:function(t,e,i,a){this.showModify=!0,a||(this.psw=void 0),this.showModify&&(this.modifyTitle=e,this.data=i,this.haspwd=a,this.olddata=i,this.type=t)},modifySub:function(){if(this.data.length>0&&this.data!==this.olddata)if("markname"===this.type)this.updateFriendMN(),this.markname=this.data;else if("email"===this.type){/^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-z0-9]+\.([a-zA-z]{2,4})$/.test(this.data)?(this.update(this.data,this.type,this.psw),this.user[this.type]=this.data):t.showToast({title:"邮箱格式错误",icon:"none",duration:1500})}else this.update(this.data,this.type,this.psw),this.user[this.type]=this.data;else t.showToast({title:"未修改内容",icon:"none",duration:1500})},quit:function(){t.removeStorage({key:"user",success:function(){}}),t.navigateTo({url:"/pages/signin/signin?name="+this.myname})},deleteFriend:function(){var e=this;t.showModal({title:"提示",content:"确定删除好友？",success:function(i){i.confirm&&t.request({url:e.serverUrl+"/friend/deletefriend",data:{uid:e.uid,fid:e.id,token:e.token},method:"POST",success:function(i){var a=i.data.status;i.data.result;200===a?t.navigateTo({url:"../userhome/userhome?id="+e.id}):500===a?t.showToast({title:"服务器出错了...",icon:"none",duration:1500}):300===a&&t.navigateTo({url:"/pages/signin/signin?name="+e.myname})}})}})},getRundate:function(){var e=this;t.request({url:this.serverUrl+"/run/findrundate",data:{id:this.uid},method:"POST",success:function(i){var a=i.data.status,n=i.data.result;200==a?(e.meter=n.distance,e.runtime=n.runTime):300==a?t.navigateTo({url:"/pages/signin/signin?name="+e.myname}):400==a||500==a&&t.showToast({title:"服务器出错了...",icon:"none",duration:1500})}})}},computed:{startDate:function(){return this.getDate("start")},endDate:function(){return this.getDate("end")}},onLoad:function(t){this.id=t.id,this.getStorages(),this.getUser(),this.getMarkname(),this.getRundate()}};e.default=s}).call(this,i("543d")["default"])},"990a":function(t,e,i){"use strict";i.r(e);var a=i("3f05"),n=i.n(a);for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);e["default"]=n.a},d63c:function(t,e,i){"use strict";(function(t){i("1a46");a(i("66fd"));var e=a(i("df97"));function a(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])},d896:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,i=(t._self._c,t.timeChange(t.user.time));t._isMounted||(t.e0=function(e){t.showModify=!1}),t.$mp.data=Object.assign({},{$root:{m0:i}})},n=[]},df97:function(t,e,i){"use strict";i.r(e);var a=i("d896"),n=i("990a");for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);i("1e23");var o=i("f0c5"),r=Object(o["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);e["default"]=r.exports},fe66:function(t,e,i){}},[["d63c","common/runtime","common/vendor"]]]);